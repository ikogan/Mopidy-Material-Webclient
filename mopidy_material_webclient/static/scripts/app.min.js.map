{"version":3,"sources":["../src/app.js","../src/controllers.js","../src/services.js"],"names":["app","angular","module","config","$mdThemingProvider","theme","primaryPalette","accentPalette","$routeProvider","when","templateUrl","controller","otherwise","redirectTo","controllers","$scope","$mdSidenav","$mdDialog","$mdToast","$location","$timeout","$http","mopidy","lastfm","settings","showNowPlaying","volume","value","bypass","timer","get","then","m","playback","getCurrentTrack","done","track","$apply","nowPlaying","getInfo","getState","state","tracklist","getLength","length","getMute","mute","getVolume","setTimeout","on","console","log","bind","e","new_state","tl_track","data","$watch","oldValue","newValue","cancel","setVolume","setMute","errback","play","pause","artists","getTrack","success","trackInfo","t","album","image","images","i","push","goTo","path","toggle","toggleSidenav","menuId","system","$event","DialogController","action","hide","closeDialog","show","targetEvent","template","response","post","simple","content","message","hideDelay","$routeParams","$window","$mdBottomSheet","$sce","type","uri","decodeURIComponent","loading","library","browse","uris","getImages","img","indexOf","lookup","info","tracks","artist","al","name","ar","getAlbum","albumInfo","getArtist","artistInfo","playlists","playlist","favourites","create","newPlaylist","asTrusted","summary","trustAsHtml","getFontIcon","ref","toLowerCase","encodeURIComponent","playAll","clear","add","back","history","search","query","showTrackActions","child","$new","isFavourite","some","itm","scope","clickedItem","getCurrentTlTrack","current","index","addToFavourites","removeFromFavourites","save","splice","haveQueue","isPlaylist","readOnly","hasOwnProperty","_","includes","refresh","asList","replaceQueue","startPlayback","addPlaylistToQueue","callback","playNext","playLast","playNow","previous","getTlTracks","tltrack","playing","getRandom","enabled","randomOn","getRepeat","repeatOn","tlid","next","toggleRandom","setRandom","toggleRepeat","setRepeat","move","from","to","remove","setConsume","SaveDialogController","parent","element","document","body","position","albums","albumsLoading","artistsLoading","tracksLoading","any","results","j","k","l","wifi","network","wifi_network","networks","ssid","JSON","parse","stringify","Date","now","extensions","forEach","key","checkForUpdates","latest","update","method","url","headers","Content-Type","listItemClick","services","factory","$q","$rootScope","Mopidy","resolve","reject","updatePageTitle","promise","service","deferred","defer","subitm","map","join","title","heading","host"],"mappings":"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","file":"app.min.js","sourcesContent":["var app = angular.module('MopidyApp', ['ngRoute', 'ngMaterial', 'angular-sortable-view', 'mopControllers', 'mopServices']);\n\napp.config(function($mdThemingProvider) {\n    $mdThemingProvider.theme('default')\n        .primaryPalette('deep-purple')\n        .accentPalette('pink');\n});\n\napp.config(['$routeProvider',\n    function ($routeProvider) {\n        $routeProvider.\n            when('/queue', {\n                templateUrl: 'partials/queue.html',\n                controller: 'QueueCtrl'\n            }).\n            when('/library', {\n                templateUrl: 'partials/library.html',\n                controller: 'LibraryCtrl'\n            }).\n            when('/library/:type/:uri', {\n                templateUrl: 'partials/library.html',\n                controller: 'LibraryCtrl'\n            }).\n            when('/playlists', {\n                templateUrl: 'partials/playlists.html',\n                controller: 'PlaylistsCtrl'\n            }).\n            when('/playlists/:uri', {\n                templateUrl: 'partials/playlists.html',\n                controller: 'PlaylistsCtrl'\n            }).\n            when('/search/:uri/:query', {\n                templateUrl: 'partials/search.html',\n                controller: 'SearchCtrl'\n            }).\n            when('/settings', {\n                templateUrl: 'partials/settings.html',\n                controller: 'SettingsCtrl'\n            }).\n            when('/about', {\n                templateUrl: 'partials/about.html',\n                controller: 'AboutCtrl'\n            })\n            .otherwise({\n                redirectTo: '/queue'\n            });\n  }]);\n","var controllers = angular.module('mopControllers', []);\n\ncontrollers.controller('AppCtrl', [\n    '$scope', '$mdSidenav', '$mdDialog', '$mdToast', '$location', '$timeout', '$http', 'mopidy', 'lastfm', 'settings',\n    function ($scope, $mdSidenav, $mdDialog, $mdToast, $location, $timeout, $http, mopidy, lastfm, settings) {\n        // Start now playing off as hidden. We'll show it once we have a queue\n        $scope.showNowPlaying = false;\n        $scope.volume = {\n            value: 0,\n            bypass: true,\n            timer: null\n        };\n\n        settings.get().then(function(settings) {\n            $scope.settings = settings['material-webclient'];\n        });\n\n        mopidy.then(function (m) {\n            m.playback.getCurrentTrack()\n                .done(function (track) {\n                    $scope.$apply(function () {\n                        $scope.nowPlaying = track;\n                        $scope.getInfo($scope.nowPlaying);\n                    });\n                });\n\n            m.playback.getState()\n                .done(function (state) {\n                    $scope.$apply(function () {\n                        $scope.state = state;\n                    });\n                });\n\n            m.tracklist.getLength().then(function(length) {\n                if(length > 0) {\n                    $scope.showNowPlaying = true;\n                }\n            });\n\n            m.playback.getMute().then(function(mute) {\n                if(mute) {\n                    $scope.volume.value = 0;\n                } else {\n                    m.playback.getVolume().then(function(volume) {\n                        $scope.volume.value = volume;\n\n                        setTimeout(function() {\n                            $scope.volume.bypass = false;\n                        });\n                    });\n                }\n            });\n\n            m.on(console.log.bind(console));\n\n            m.on('event:tracklistChanged', function(e) {\n                m.tracklist.getLength().then(function(length) {\n                    $scope.showNowPlaying = (length > 0);\n                })\n            });\n\n            m.on('event:playbackStateChanged', function (e) {\n                $scope.$apply(function () {\n                    $scope.state = e.new_state;\n                });\n            });\n\n            m.on('event:trackPlaybackStarted', function (e) {\n                $scope.$apply(function () {\n                    $scope.nowPlaying = e.tl_track.track;\n                    $scope.getInfo($scope.nowPlaying);\n                });\n            });\n\n            m.on('event:volumeChanged', function(e) {\n                $scope.$apply(function() {\n                    $scope.volume.bypass = true;\n                    $scope.volume.value = e.volume;\n\n                    setTimeout(function() {\n                        $scope.volume.bypass = false;\n                    }, 0);\n                })\n            });\n\n            m.on('event:muteChanged', function(e) {\n                $scope.$apply(function() {\n                    $scope.volume.bypass = true;\n                    if(e.mute) {\n                        $scope.volume.value = 0;\n                    } else {\n                        m.playback.getVolume().then(function(data) {\n                            $scope.volume.value = data.volume;\n\n                            setTimeout(function() {\n                                $scope.volume.bypass = false;\n                            }, 0);\n                        });\n                    }\n                });\n            });\n\n            $scope.$watch('volume.value', function(oldValue, newValue) {\n                if(newValue && !$scope.volume.bypass) {\n                    $timeout.cancel($scope.volume.timer);\n                    $scope.volume.timer = $timeout(function() {\n                        m.playback.setVolume(newValue);\n                        m.playback.setMute(false);\n                    }, 100);\n                }\n            });\n\n            m.errback = function (e) {\n                console.log(e);\n            };\n\n            $scope.play = function () {\n                m.playback.play();\n            };\n\n            $scope.pause = function () {\n                m.playback.pause();\n            };\n        });\n\n        $scope.getInfo = function (track) {\n            if (!track || track.artists.length === 0) {\n                return;\n            }\n            lastfm.getTrack(track).success(function (trackInfo) {\n                var t = trackInfo.track;\n                if (!t) {\n                    return;\n                }\n\n                if (t.album &&\n                    t.album.image &&\n                    t.album.image.length > 0) {\n                    $scope.nowPlaying.album = t.album;\n                    $scope.nowPlaying.album.images = [];\n                    for (var i = 0; i < t.album.image.length; i++) {\n                        $scope.nowPlaying.album.images.push(t.album.image[i]['#text']);\n                    }\n                }\n            });\n        };\n\n        $scope.goTo = function (path) {\n            $location.path(path);\n            $mdSidenav('left').toggle();\n        };\n\n        $scope.toggleSidenav = function (menuId) {\n            $mdSidenav(menuId).toggle();\n        };\n\n        $scope.system = function ($event) {\n\n            function DialogController($scope, $mdDialog) {\n                $scope.action = function (value) {\n                    $mdDialog.hide(value);\n                };\n                $scope.closeDialog = function () {\n                    $mdDialog.cancel();\n                };\n            }\n\n            $mdDialog.show({\n                targetEvent: $event,\n                template:\n                    '<md-dialog aria-label=\"List dialog\">' +\n                        '  <md-dialog-content>' +\n                        '    <md-list>' +\n                        '      <md-list-item ng-click=\"action(\\'restart\\')\">' +\n                        '        <md-icon class=\"md-accent\">refresh</md-icon><p>Restart</p>' +\n                        '      </md-list-item>' +\n                        '      <md-list-item ng-click=\"action(\\'about\\')\">' +\n                        '        <md-icon class=\"md-accent\">info</md-icon><p>About</p>' +\n                        '      </md-list-item>' +\n                        '      <md-list-item ng-click=\"closeDialog()\">' +\n                        '        <md-icon>cancel</md-icon><p>Cancel</p>' +\n                        '      </md-list-item>' +\n                        '    </md-list>' +\n                        '  </md-dialog-content>' +\n                        '</md-dialog>',\n                controller: DialogController\n            }).then(function (response) {\n                if (response == 'about') {\n                    $location.path('about');\n                } else if (response == 'restart') {\n                    $http.post('/material-webclient/restart').success(function (response) {\n                        $mdToast.show(\n                            $mdToast.simple()\n                            .content(response.message)\n                            .hideDelay(3000)\n                        );\n                    });\n                }\n                console.log(response);\n            });\n        };\n    }\n]);\n\ncontrollers.controller('LibraryCtrl', [\n    '$scope', '$routeParams', '$location', '$window', '$mdBottomSheet', '$sce', 'mopidy', 'lastfm',\n    function ($scope, $routeParams, $location, $window, $mdBottomSheet, $sce, mopidy, lastfm) {\n        var type = null;\n        var uri = null;\n\n        if ($routeParams.type) {\n            type = decodeURIComponent($routeParams.type);\n        }\n        if ($routeParams.uri) {\n            uri = decodeURIComponent($routeParams.uri);\n            $scope.uri = uri;\n        }\n\n        $scope.loading = true;\n\n        mopidy.then(function (m) {\n            $scope.mopidy = m;\n            m.library.browse(uri).done(\n                function (content) {\n                    var uris = [];\n\n                    $scope.$apply(function () {\n                        $scope.content = content;\n                        $scope.loading = false;\n                    });\n\n                    for (var i = 0; i < content.length; i++) {\n                        if (content[i].type == 'track') {\n                            uris.push(content[i].uri);\n                        }\n                    }\n\n                    if (type) {\n                        m.library.getImages(uris).done(function (images) {\n                            $scope.$apply(function () {\n                                for (var i = 0; i < $scope.content.length; i++) {\n                                    var img = images[$scope.content[i].uri];\n                                    if (img && img.length > 0) {\n                                        $scope.content[i].image = img[0].uri;\n                                    }\n                                }\n                            });\n                        });\n                    }\n                });\n\n            if (type &&\n                type != 'directory' &&\n                uri.indexOf('podcast') !== 0) {\n                m.library.lookup(uri).done(function (info) {\n                    $scope.tracks = info;\n                    var album;\n                    var artist;\n                    if (info.length > 0) {\n                        album = info[0].album;\n                        artist = info[0].artists && info[0].artists.length > 0 ? info[0].artists[0] : null;\n                    }\n\n                    for (var i = 1; i < info.length; i++) {\n                        var al = info[i].album;\n                        if (album && al && al.name != album.name) {\n                            album = null;\n                        }\n                        var ar = info[i].artists && info[i].artists.length > 0 ? info[i].artists[0] : null;\n                        if (artist && ar && ar.name != artist.name) {\n                            artist = null;\n                        }\n                    }\n\n                    if (type == 'album' && album) {\n                        lastfm.getAlbum(album).success(function (albumInfo) {\n                            $scope.albumInfo = albumInfo.album;\n                        });\n                    }\n\n                    if (type == 'artist' && artist) {\n                        lastfm.getArtist(artist).success(function (artistInfo) {\n                            $scope.artistInfo = artistInfo.artist;\n                        });\n                    }\n                });\n            }\n\n            m.playlists.lookup('m3u:Favourites.m3u').done(function (playlist) {\n                if (!playlist) {\n                    m.playlists.create('Favourites', 'm3u').done(function (newPlaylist) {\n                        $scope.favourites = newPlaylist;\n                    });\n                } else {\n                    $scope.favourites = playlist;\n                }\n            });\n        });\n\n        $scope.asTrusted = function (summary) {\n            return $sce.trustAsHtml(summary);\n        };\n\n        $scope.getFontIcon = function (ref) {\n            if (ref.type.toLowerCase() == 'track') {\n                return 'fa-music';\n            } else {\n                if (ref.uri.indexOf('spotify') === 0) {\n                    return 'fa-spotify';\n                } else if (ref.uri.indexOf('tunein:') === 0) {\n                    return 'fa-headphones';\n                } else if (ref.uri.indexOf('podcast:') === 0) {\n                    return 'fa-rss';\n                } else if (ref.uri.indexOf('soundcloud:') === 0) {\n                    return 'fa-soundcloud';\n                } else if (ref.uri.indexOf('gmusic:') === 0) {\n                    return 'fa-google';\n                } else {\n                    return 'fa-folder-o';\n                }\n            }\n        };\n\n        $scope.goTo = function (ref) {\n            if (ref.type != 'track') {\n                $location.path('library/' + ref.type + '/' + encodeURIComponent(ref.uri));\n            } else {\n                $scope.mopidy.play(ref.uri);\n            }\n        };\n\n        $scope.playAll = function () {\n            $scope.mopidy.tracklist.clear();\n            var uris = [];\n            for (var i = 0; i < $scope.tracks.length; i++) {\n                uris.push($scope.tracks[i].uri);\n            }\n            $scope.mopidy.tracklist.add(null, null, null, uris).then(function () {\n                $scope.mopidy.playback.play();\n            });\n        };\n\n        $scope.back = function () {\n            $window.history.back();\n        };\n\n        $scope.search = function (uri, query) {\n            $location.path('search/' + encodeURIComponent(uri) + '/' + encodeURIComponent(query));\n        };\n\n        $scope.showTrackActions = function ($event, track) {\n\n            var child = $scope.$new();\n\n            if ($scope.favourites.tracks) {\n                child.isFavourite = $scope.favourites.tracks.some(function (itm) {\n                    return itm.uri == track.uri;\n                });\n            }\n\n            $mdBottomSheet.show({\n                templateUrl: 'partials/track-actions.html',\n                controller: 'TrackActionsCtrl',\n                targetEvent: $event,\n                scope: child\n            }).then(function (clickedItem) {\n                if (clickedItem == 'play-next') {\n                    $scope.mopidy.playback.getCurrentTlTrack().done(function (current) {\n                        console.log(current);\n                        $scope.mopidy.tracklist.index(current).done(function (index) {\n                            $scope.mopidy.tracklist.add(null, index + 1, null, [track.uri]);\n                        });\n                    });\n                } else if (clickedItem == 'add-to-queue') {\n                    $scope.mopidy.tracklist.add(null, null, null, [track.uri]);\n                } else if (clickedItem == 'add-to-favourites') {\n                    $scope.addToFavourites(track.uri);\n                } else if (clickedItem == 'remove-from-favourites') {\n                    $scope.removeFromFavourites(track.uri);\n                }\n            });\n        };\n\n        $scope.addToFavourites = function (uri) {\n            $scope.mopidy.library.lookup(uri).done(function (tracks) {\n                if (!$scope.favourites.tracks) {\n                    $scope.favourites.tracks = tracks;\n                } else {\n                    $scope.favourites.tracks.push(tracks[0]);\n                }\n                $scope.mopidy.playlists.save($scope.favourites).done(function (playlist) {\n                    $scope.favourites = playlist;\n                });\n            });\n        };\n\n        $scope.removeFromFavourites = function (uri) {\n            for (var i = 0; i < $scope.favourites.tracks.length; i++) {\n                if ($scope.favourites.tracks[i].uri == uri) {\n                    $scope.favourites.tracks.splice(i, 1);\n                }\n            }\n            $scope.mopidy.playlists.save($scope.favourites).done(function (playlist) {\n                $scope.favourites = playlist;\n            });\n        };\n    }\n]);\n\ncontrollers.controller('PlaylistsCtrl', [\n    '$scope', '$routeParams', '$location', 'mopidy',\n    function ($scope, $routeParams, $location, mopidy) {\n        var uri = $routeParams.uri;\n\n        mopidy.then(function (m) {\n            $scope.mopidy = m;\n\n            m.tracklist.getLength().then(function(length) {\n                $scope.haveQueue = length > 0;\n            });\n\n            if (uri) {\n                $scope.isPlaylist = true;\n\n                m.playlists.lookup(uri).done(\n                    function (playlist) {\n                        console.log(playlist);\n                        $scope.$apply(function () {\n                            $scope.playlist = playlist;\n                            $scope.readOnly = playlist.uri.indexOf('m3u:') !== 0;\n                            $scope.content = playlist.tracks;\n\n                            var uris = [];\n                            for (var i = 0; i < $scope.content.length && i < 9; i++) {\n                                uris.push($scope.content[i].uri);\n                            }\n\n                            m.library.getImages(uris).done(function (images) {\n                                $scope.$apply(function () {\n                                    $scope.images = [];\n                                    for(var i in images) {\n                                        if(images.hasOwnProperty(i) && images[i].length > 0 &&\n                                            !_.includes($scope.images, images[i][0].uri)) {\n                                                $scope.images.push(images[i][0].uri);\n                                        }\n                                    }\n                                });\n                            });\n                        });\n                    });\n            } else {\n                m.playlists.refresh().done(function () {\n                    m.playlists.asList().done(\n                        function (content) {\n                            $scope.$apply(function () {\n                                $scope.content = content;\n                            });\n                        });\n                });\n            }\n        });\n\n        $scope.getFontIcon = function (ref) {\n            if (ref.uri.indexOf('spotify') === 0) {\n                return 'fa-spotify';\n            } else if (ref.uri.indexOf('tunein:') === 0) {\n                return 'fa-headphones';\n            } else if (ref.uri.indexOf('podcast') === 0) {\n                return 'fa-rss';\n            } else if (ref.uri.indexOf('soundcloud') === 0) {\n                return 'fa-soundcloud';\n            } else if (ref.uri.indexOf('gmusic') === 0) {\n                return 'fa-google';\n            } else if ($scope.isPlaylist) {\n                return 'fa-music';\n            } else {\n                return 'fa-folder-o';\n            }\n        };\n\n        $scope.goTo = function(ref) {\n            if ($scope.isPlaylist) {\n                $scope.mopidy.tracklist.clear();\n                $scope.mopidy.tracklist.add(null, null, null, [ref.uri])\n                    .then(function () {\n                        $scope.mopidy.playback.play();\n                    });\n            } else {\n                $location.path('playlists/' + ref.uri);\n            }\n        };\n\n        $scope.replaceQueue = function(startPlayback) {\n            $scope.mopidy.tracklist.clear().done(function () {\n                $scope.addPlaylistToQueue(function() {\n                    if(startPlayback) {\n                        $scope.mopidy.playback.play();\n                    }\n                });\n            });\n        };\n\n        $scope.addPlaylistToQueue = function(callback) {\n            var uris = [];\n            for (var i = 0; i < $scope.content.length; i++) {\n                uris.push($scope.content[i].uri);\n            }\n\n            $scope.mopidy.tracklist.add(null, null, null, uris).done(function () {\n                if(callback) {\n                    callback();\n                }\n            });\n        };\n\n        $scope.playNext = function(track) {\n            $scope.mopidy.tracklist.index().then(function(index) {\n                index = index || 1;\n                $scope.mopidy.tracklist.add(null, index+1, null, [track.uri]);\n            });\n        };\n\n        $scope.playLast = function(track) {\n            $scope.mopidy.tracklist.add(null, null, null, [track.uri]);\n        };\n\n        $scope.playNow = function(track) {\n            $scope.mopidy.tracklist.index().then(function(index) {\n                index = index || 1;\n                $scope.mopidy.tracklist.add(null, index, null, [track.uri]).then(function() {\n                    $scope.mopidy.playback.previous();\n                });\n            });\n        }\n    }\n]);\n\ncontrollers.controller('QueueCtrl', [\n    '$scope', '$mdDialog', '$mdToast', 'mopidy', 'lastfm',\n    function ($scope, $mdDialog, $mdToast, mopidy, lastfm) {\n        mopidy.then(function (m) {\n\n            $scope.mopidy = m;\n            m.tracklist.getTlTracks().then(function (tracks) {\n                $scope.$apply(function () {\n                    $scope.tracks = tracks;\n                });\n\n                m.playback.getCurrentTlTrack()\n                    .done(function (tltrack) {\n                        $scope.$apply(function () {\n                            $scope.playing = tltrack;\n                            $scope.loading = false;\n                            if (tltrack) {\n                                $scope.getInfo(tltrack.track);\n                            }\n                        });\n                    });\n            });\n\n            m.tracklist.getRandom().done(function (enabled) {\n                $scope.$apply(function () {\n                    $scope.randomOn = enabled;\n                });\n            });\n\n            m.tracklist.getRepeat().done(function (enabled) {\n                $scope.$apply(function () {\n                    $scope.repeatOn = enabled;\n                });\n            });\n\n            m.on('event:tracklistChanged', function () {\n                m.tracklist.getTlTracks().then(function (tracks) {\n                    if(tracks.length !== tracks) {\n                        $scope.$apply(function () {\n                            $scope.tracks = tracks;\n                        });\n                    }\n                });\n            });\n\n            m.playback.getState()\n                .done(function (state) {\n                    $scope.$apply(function () {\n                        $scope.state = state;\n                    });\n                });\n\n            m.on('event:playbackStateChanged', function (e) {\n                $scope.$apply(function () {\n                    $scope.state = e.new_state;\n                });\n            });\n\n            m.on('event:trackPlaybackStarted', function (e) {\n                $scope.$apply(function () {\n                    $scope.playing = e.tl_track;\n                    $scope.getInfo($scope.nowPlaying);\n                });\n            });\n        });\n\n        $scope.getInfo = function (track) {\n            if (!track || track.artists.length === 0) {\n                return;\n            }\n            lastfm.getTrack(track).success(function (trackInfo) {\n                var t = trackInfo.track;\n                if (!t) {\n                    return;\n                }\n\n                if (t.album &&\n                    t.album.image &&\n                    t.album.image.length > 0) {\n                    $scope.playing.track.album = t.album;\n                    $scope.playing.track.album.images = [];\n                    for (var i = 0; i < t.album.image.length; i++) {\n                        $scope.playing.track.album.images.push(t.album.image[i]['#text']);\n                    }\n                }\n            });\n        };\n\n        $scope.play = function (track) {\n            if ($scope.state == 'playing' && track.tlid == $scope.playing.tlid) {\n                $scope.mopidy.playback.pause();\n            } else {\n                $scope.mopidy.playback.play(track);\n            }\n        };\n\n        $scope.previous = function () {\n            $scope.mopidy.playback.previous();\n        };\n\n        $scope.next = function () {\n            $scope.mopidy.playback.next();\n        };\n\n        $scope.toggleRandom = function () {\n            $scope.mopidy.tracklist.setRandom(!$scope.randomOn).done(\n                function () {\n                    $scope.$apply(function () {\n                        $scope.randomOn = !$scope.randomOn;\n                    });\n                });\n        };\n\n        $scope.toggleRepeat = function () {\n            $scope.mopidy.tracklist.setRepeat(!$scope.repeatOn).done(\n                function () {\n                    $scope.$apply(function () {\n                        $scope.repeatOn = !$scope.repeatOn;\n                    });\n                });\n        };\n\n        $scope.move = function(track, from, to) {\n            $scope.mopidy.tracklist.move(from, from, to);\n        };\n\n        $scope.remove = function (track, index) {\n            $scope.tracks.splice(index, 1);\n            $scope.mopidy.tracklist.remove({ tlid: [track.tlid] });\n        };\n\n        $scope.clear = function () {\n            $scope.mopidy.tracklist.clear();\n        };\n\n        $scope.setConsume = function () {\n            $scope.mopidy.tracklist.setConsume(true).then();\n        };\n\n        $scope.save = function ($event) {\n            $mdDialog.show({\n                targetEvent: $event,\n                parent: angular.element(document.body),\n                template:\n                    '<md-dialog aria-label=\"Save playlist\" flex=\"20\">' +\n                        '  <md-dialog-content>' +\n                        '    <h3 class=\"md-title\">New playlist</h3>' +\n                        '    <form>' +\n                        '      <md-input-container flex>' +\n                        '        <label>Name</label>' +\n                        '        <input type=\"text\" required ng-model=\"name\"/>' +\n                        '      </md-input-container>' +\n                        '    </form>' +\n                        '  </md-dialog-content>' +\n                        '  <div class=\"md-actions\">' +\n                        '    <md-button ng-click=\"cancel()\" class=\"md-primary\">' +\n                        '      Cancel' +\n                        '    </md-button>' +\n                        '    <md-button ng-click=\"save()\" class=\"md-primary\">' +\n                        '      Create playlist' +\n                        '    </md-button>' +\n                        '  </div>' +\n                        '</md-dialog>',\n                controller: SaveDialogController\n            }).then(function (name) {\n                if (!name) {\n                    return;\n                }\n\n                $scope.mopidy.playlists.create(name, 'm3u').done(function (newPlaylist) {\n                    newPlaylist.tracks = [];\n                    for (var i = 0; i < $scope.tracks.length; i++) {\n                        newPlaylist.tracks.push($scope.tracks[i].track);\n                    }\n                    $scope.mopidy.playlists.save(newPlaylist).done(function (playlist) {\n                        $mdToast.show(\n                            $mdToast.simple()\n                            .content('New playlist ' + playlist.name + ' created')\n                            .position('bottom')\n                            .hideDelay(1500)\n                        );\n                    });\n                });\n            });\n\n            function SaveDialogController($scope, $mdDialog) {\n                $scope.cancel = function () {\n                    $mdDialog.cancel();\n                };\n                $scope.save = function () {\n                    $mdDialog.hide($scope.name);\n                };\n            }\n        };\n    }\n]);\n\ncontrollers.controller('SearchCtrl', [\n    '$scope', '$routeParams', '$mdBottomSheet', '$location', 'mopidy',\n    function ($scope, $routeParams, $mdBottomSheet, $location, mopidy) {\n\n        $scope.albums = [];\n        $scope.albumsLoading = true;\n        $scope.artists = [];\n        $scope.artistsLoading = true;\n        $scope.tracks = [];\n        $scope.tracksLoading = true;\n\n        var uri = decodeURIComponent($routeParams.uri);\n        var query = decodeURIComponent($routeParams.query);\n\n        mopidy.then(function (m) {\n            $scope.mopidy = m;\n            m.library.search({ 'any': query }, [uri]).then(function (results) {\n                $scope.$apply(function () {\n                    for (var i = 0; i < results.length; i++) {\n                        var library = results[i];\n\n                        $scope.albumsLoading = false;\n                        if (library.albums) {\n                            for (var j = 0; j < library.albums.length; j++) {\n                                $scope.albums.push(library.albums[j]);\n                            }\n                        }\n\n                        $scope.artistsLoading = false;\n                        if (library.artists) {\n                            for (var k = 0; k < library.artists.length; k++) {\n                                $scope.artists.push(library.artists[k]);\n                            }\n                        }\n\n                        $scope.tracksLoading = false;\n                        if (library.tracks) {\n                            for (var l = 0; l < library.tracks.length; l++) {\n                                $scope.tracks.push(library.tracks[l]);\n                            }\n                        }\n                    }\n                });\n\n                console.log(results);\n            });\n\n            m.playlists.lookup('m3u:Favourites.m3u').done(function (playlist) {\n                if (!playlist) {\n                    m.playlists.create('Favourites', 'm3u').done(function (newPlaylist) {\n                        $scope.favourites = newPlaylist;\n                    });\n                } else {\n                    $scope.favourites = playlist;\n                }\n            });\n        });\n\n        $scope.goto = function (type, uri) {\n            $location.path('library/' + type + '/' + encodeURIComponent(uri));\n        };\n\n        $scope.play = function (track) {\n            $scope.mopidy.play(track.uri);\n        };\n\n        $scope.showTrackActions = function ($event, track) {\n\n            var child = $scope.$new();\n\n            if ($scope.favourites.tracks) {\n                child.isFavourite = $scope.favourites.tracks.some(function (itm) {\n                    return itm.uri == track.uri;\n                });\n            }\n\n            $mdBottomSheet.show({\n                templateUrl: 'partials/track-actions.html',\n                controller: 'TrackActionsCtrl',\n                targetEvent: $event,\n                scope: child\n            }).then(function (clickedItem) {\n                if (clickedItem == 'play-next') {\n                    $scope.mopidy.playback.getCurrentTlTrack().done(function (current) {\n                        console.log(current);\n                        $scope.mopidy.tracklist.index(current).done(function (index) {\n                            $scope.mopidy.tracklist.add(null, index + 1, null, [track.uri]);\n                        });\n                    });\n                } else if (clickedItem == 'add-to-queue') {\n                    $scope.mopidy.tracklist.add(null, null, null, [track.uri]);\n                } else if (clickedItem == 'add-to-favourites') {\n                    $scope.addToFavourites(track.uri);\n                } else if (clickedItem == 'remove-from-favourites') {\n                    $scope.removeFromFavourites(track.uri);\n                }\n            });\n        };\n\n        $scope.addToFavourites = function (uri) {\n            $scope.mopidy.library.lookup(uri).done(function (tracks) {\n                if (!$scope.favourites.tracks) {\n                    $scope.favourites.tracks = tracks;\n                } else {\n                    $scope.favourites.tracks.push(tracks[0]);\n                }\n                $scope.mopidy.playlists.save($scope.favourites).done(function (playlist) {\n                    $scope.favourites = playlist;\n                });\n            });\n        };\n\n        $scope.removeFromFavourites = function (uri) {\n            for (var i = 0; i < $scope.favourites.tracks.length; i++) {\n                if ($scope.favourites.tracks[i].uri == uri) {\n                    $scope.favourites.tracks.splice(i, 1);\n                }\n            }\n            $scope.mopidy.playlists.save($scope.favourites).done(function (playlist) {\n                $scope.favourites = playlist;\n            });\n        };\n    }\n]);\n\ncontrollers.controller('SettingsCtrl', [\n    '$scope', '$http', '$mdToast', 'settings',\n    function ($scope, $http, $mdToast, settings) {\n        settings.get().then(function (settings) {\n            $scope.wifi = $scope.wifi ? $scope.wifi : [];\n            $scope.settings = settings;\n            if ($scope.wifi.indexOf(settings.network.wifi_network) < 0) {\n                $scope.wifi.push(settings.network.wifi_network);\n            }\n        });\n\n        $http.get('/material-webclient/wifi').success(function (networks) {\n            $scope.wifi = $scope.wifi ? $scope.wifi : [];\n            for (var i = 0; i < networks.length; i++) {\n                if ($scope.wifi.indexOf(networks[i].ssid) < 0) {\n                    $scope.wifi.push(networks[i].ssid);\n                }\n            }\n        });\n\n        $scope.save = function () {\n            var data = JSON.parse(JSON.stringify($scope.settings));\n            settings.save(data).then(function() {\n                $mdToast.show(\n                    $mdToast.simple()\n                        .content(response.message)\n                        .hideDelay(3000)\n                );\n            });\n        };\n    }\n]);\n\ncontrollers.controller('AboutCtrl', [\n    '$scope', '$http', '$mdToast',\n    function ($scope, $http, $mdToast) {\n        $scope.loading = true;\n\n        $scope.refresh = function () {\n            $http.get('/material-webclient/extensions?' + Date.now()).success(function (response) {\n                $scope.loading = false;\n                var extensions = {};\n                angular.forEach(response, function (value, key) {\n                    if (key.indexOf('Mopidy') >= 0) {\n                        extensions[key] = { current: value };\n                    }\n                });\n                $scope.extensions = extensions;\n            });\n        };\n\n        $scope.refresh();\n\n        $scope.checkForUpdates = function () {\n            $scope.loading = true;\n            $http.get('/material-webclient/extensions?outdated=true&' + Date.now()).success(function (response) {\n                var message = 'No updates found';\n                for (var itm in response) {\n                    if ($scope.extensions[itm]) {\n                        $scope.extensions[itm].latest = response[itm].latest;\n                        message = 'Updates found for installed modules';\n                    }\n                }\n                $scope.loading = false;\n                $mdToast.show(\n                    $mdToast.simple()\n                        .content(message)\n                        .hideDelay(3000)\n                );\n            });\n        };\n\n        $scope.update = function (name) {\n            $http({\n                method: 'POST',\n                url: '/material-webclient/extensions',\n                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n                data: 'extension=' + name\n            }).success(function (response) {\n                $mdToast.show(\n                    $mdToast.simple()\n                        .content(response.message)\n                        .hideDelay(3000)\n                );\n            });\n        };\n    }]);\n\ncontrollers.controller('TrackActionsCtrl', function ($scope, $mdBottomSheet) {\n    $scope.listItemClick = function (clickedItem) {\n        $mdBottomSheet.hide(clickedItem);\n    };\n});\n","var services = angular.module('mopServices', []);\n\nservices.factory('mopidy', ['$q', '$rootScope', '$location', 'settings',\n    function ($q, $rootScope, $location, settings) {\n        var mopidy = new Mopidy();\n        return $q(function (resolve, reject) {\n            mopidy.on(\"state:online\", function () {\n                mopidy.playback.getCurrentTlTrack()\n                    .done(function (tltrack) {\n                        if(tltrack) {\n                            mopidy.nowPlaying = tltrack.track;\n                        }\n\n                        settings.updatePageTitle(tltrack ? 'playing' : 'stopped', mopidy.nowPlaying);\n                    });\n\n                mopidy.on('event:trackPlaybackStarted', function (e) {\n                    mopidy.nowPlaying = e.tl_track.track;\n                    settings.updatePageTitle('playing', mopidy.nowPlaying);\n                });\n\n                mopidy.on('event:playbackStateChanged', function (e) {\n                    settings.updatePageTitle(e.new_state, mopidy.nowPlaying);\n                });\n\n                mopidy.play = function (uri) {\n                    mopidy.tracklist.index(mopidy.nowPlaying).then(function (position) {\n                        mopidy.tracklist.add(null, position + 1, null, [uri]).then(function (tracks) {\n                            mopidy.playback.play(tracks[0]);\n                        });\n                    });\n                };\n\n                resolve(mopidy);\n            });\n        });\n    }\n]);\n\nservices.factory('lastfm', [\n    '$q', '$http',\n    function ($q, $http) {\n        var key = '2b640713cdc23381c5fb5fc3ef65b576';\n        var lastfm = {\n            getAlbum: function (album) {\n                return $http.get(\"https://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=\" + key +\n                    \"&artist=\" + encodeURIComponent(album.artists[0].name) +\n                    \"&album=\" + encodeURIComponent(album.name) +\n                    \"&format=json\");\n            },\n            getArtist: function (artist) {\n                return $http.get(\"https://ws.audioscrobbler.com/2.0/?method=artist.getinfo&api_key=\" + key +\n                    \"&artist=\" + encodeURIComponent(artist.name) +\n                    \"&format=json\");\n            },\n            getTrack: function (track) {\n                return $http.get(\"https://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=\" + key +\n                    \"&artist=\" + encodeURIComponent(track.artists[0].name) +\n                    \"&track=\" + encodeURIComponent(track.name) +\n                    \"&format=json\");\n            }\n        };\n\n        return lastfm;\n    }\n]);\n\nservices.factory('settings', [\n    '$q', '$http', '$rootScope',\n    function($q, $http, $rootScope) {\n        var settings = null;\n        var promise = null;\n\n        var service = {\n            get: function() {\n                var deferred = $q.defer();\n\n                if(settings) {\n                    deferred.resolve(settings);\n                }\n\n                if(promise) {\n                    return promise;\n                }\n\n                $http.get('/material-webclient/settings').success(function (settings) {\n                    for (var itm in settings) {\n                        if (settings.hasOwnProperty(itm)) {\n                            var subitm = settings[itm];\n                            for (var key in subitm) {\n                                if (subitm.hasOwnProperty(key)) {\n                                    if (subitm[key] === 'true') {\n                                        subitm[key] = true;\n                                    }\n                                }\n                            }\n                        }\n                    }\n\n                    deferred.resolve(settings);\n                });\n\n                promise = deferred.promise;\n                return promise;\n            },\n\n            save: function(data) {\n                var deferred = $q.defer();\n\n                for (var itm in data) {\n                    if (data.hasOwnProperty(itm)) {\n                        var subitm = data[itm];\n                        for (var key in subitm) {\n                            if (subitm.hasOwnProperty(key)) {\n                                if (typeof subitm[key] === 'boolean') {\n                                    subitm[key] = 'true';\n                                }\n                            }\n                        }\n                    }\n                }\n\n                $http.post('/material-webclient/settings', data)\n                    .success(function (response) {\n                        settings = data;\n\n                        $q.resolve();\n                    });\n\n                return deferred.promise;\n            },\n\n            updatePageTitle: function(state, track) {\n                if (track && typeof track.artists != 'undefined') {\n                    var artists = track.artists.map(\n                        function(artist){\n                            return artist.name;\n                        }).join(\", \");\n                }\n\n                if(track) {\n                    var title = null;\n                    if (state == 'playing') {\n                        title = '\\u25B6 ' + track.name + ' - ' + artists + ' | Mopidy';\n                    } else if (state == 'paused') {\n                        title = '\\u2759\\u2759 ' + track.name + ' - ' + artists + ' | Mopidy';\n                    }\n                }\n\n                service.get().then(function(settings) {\n                    if(settings['material-webclient'].title) {\n                        $rootScope.title = title ? title : settings['material-webclient'].title;\n                        $rootScope.heading = settings['material-webclient'].title;\n                    } else {\n                        $rootScope.title = $location.host;\n                        $rootScope.heading = $location.host;\n                    }\n                });\n            }\n        }\n\n        return service;\n    }\n]);\n"]}